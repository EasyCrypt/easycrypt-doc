# --------------------------------------------------------------------
import re

# --------------------------------------------------------------------
__all__ = ['setup']

# --------------------------------------------------------------------
_pdollar = re.compile(r'(?:^|(?<=\s|[(]))[~]([^\n]*?)(?<![\\])[~](?:~|(?=\s|[.,;)\\]))')
_ndollar = re.compile(r'\\[~]')

# --------------------------------------------------------------------
def source_read_handler(app, docname, source):
    source[0] = _pdollar.sub(r':easycrypt:`\1`', source[0])
    source[0] = _ndollar.sub('~', source[0])

# --------------------------------------------------------------------
def setup(app):
    app.connect('source-read', source_read_handler)
    return dict(version = '1.0')
