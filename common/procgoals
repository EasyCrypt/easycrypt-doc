#!/bin/bash

# procgoals -- process goals generated by EasyCrypt's 'dump' command,
# making them ready for inclusion in LaTeX documents using listings
# package

# for each argument, $arg:
#
# strip off any trailing ".ec" of $arg, giving us $base; if $base.ec
# and $base.0.ec don't both exist, then ignore
#
# for each file, $fil, matching $base.+([0-9]).ec (with extended
# regular expression syntax) replace lines consisting entirely of one
# or more dashes (-) with: '#\hrulefil\hspace*{.5cm}#'

shopt -s extglob # turn extended regular expressions on

function procfile ()
{
    base=${1%.ec};
    if [ ! -e $base.ec ] || [ ! -e $base.0.ec ];
    then echo argument "'"$1"'" ignored;
    else echo processing "'"$base"'"
         for file in $base.+([0-9]).ec;
         do sed 's/^--*$/#\\hrulefill\\hspace*{.5cm}#/' $file > $tmpfil
            mv $tmpfil $file
        done;
    fi;
}

tmpfil=/tmp/easycrypt-dump.$$
rm -f $tmpfil

for arg in $*;
do procfile $arg;
done;

rm -f $tmpfil
