% !TeX root = easycrypt.tex
%% Misc
\newcommand{\DONE}{}% {{\color{red}DONE}}
\newcommand{\Example}{\paragraph*{Example}}
\newcommand{\Syntax}{\paragraph*{Syntax}}
\newcommand{\Description}{\paragraph*{Description}}
\setcounter{secnumdepth}{3}
\renewcommand{\thesubsubsection}{\arabic{chapter}.\arabic{section}.\arabic{subsection}.\arabic{subsubsection}}
\newbox\minicodebox
\newenvironment{minicode}[1]{%
\minipage[t]{#1\linewidth} %
\centering %
\verbatim %
}{%
\endverbatim %
\endminipage% 
}




% \newcounter{todos}\setcounter{todos}{1}
% \newcommand{\TODO}[1]{%
%   \textsf{\textcolor{red}{$^{[\thetodos]}$}}%
%   \marginpar{%
%     \framebox[1.2\marginparwidth][t]{%
%       \parbox[t]{\marginparwidth}{%
%         \raggedright\scriptsize{
%           \textcolor{red}{\thetodos: #1}%
%         }}}}%
%   \stepcounter{todos}%
% }
\newcounter{alarmcounter}
\setcounter{alarmcounter}{1}
\newcommand{\alarm}[1]
            {\begingroup
              \def\thefootnote{{\normalsize\color{red}(\arabic{footnote})}}
              \footnote{\textsf{\textbf{{\color{red}\sc \bf ALARM:}
                  #1}}}\endgroup}

% \providecommand{\note}[1]{
%  \noindent{\color{red}
%  \framebox[\textwidth][t]{%
%   \parbox[t]{0.98\textwidth}{\textcolor{red}{#1}}
% }}}

\newcommand{\infr}[2]{
{\renewcommand{\arraystretch}{1.1}
\begin{array}{c}
{#1}\\
\hline
{#2}
\end{array}}}

\providecommand{\eqref}[1]{\textup{(\ref{#1})}}
\providecommand{\eqdef}{\raisebox{-.2ex}[.2ex]{$\stackrel{\textrm{\tiny def}}{~=~}$}}
\newcommand{\gl}{\boldsymbol}
\newcommand{\game}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\tactic}{\texttt}
\newcommand{\fail}{F}
\newcommand{\bad}{\mathbf{bad}}
\newcommand{\result}{\mathsf{res}}
\newcommand{\guess}[1]{\tilde{#1}}
\newcommand{\challenge}[1]{\gl{#1^*}}
\newcommand{\uptobad}[2]{\mathsf{uptobad}({#1},{#2})}
\providecommand{\implies}{\Longrightarrow}
\newcommand{\cnt}{\mathsf{cntr}}
\newcommand{\qG}{q_\mathsf{G}}
\newcommand{\qH}{q_\mathsf{H}}
\newcommand{\qS}{q_\mathsf{S}}
\newcommand{\qD}{q_\Dec}

%% Names

\newcommand{\CertiCrypt}{\textsf{CertiCrypt}\xspace}
\newcommand{\CertiPriv}{\textsf{CertiPriv}\xspace}
\newcommand{\ProVerif}{\textsf{ProVerif}\xspace}
\newcommand{\CryptoVerif}{\textsf{CryptoVerif}\xspace}
\newcommand{\Coq}{\textsf{Coq}\xspace}
\newcommand{\CIL}{\textsf{CIL}\xspace}
\newcommand{\pWHILE}{\textsf{p}\textsc{While}\xspace}
\newcommand{\Why}{\textsf{Why}\xspace}
\newcommand{\altergo}{\textsf{alt-ergo}\xspace}
\newcommand{\simplify}{\textsf{Simplify}\xspace}

%% Security properties and schemes

\newcommand{\INDCPA}{\textsf{IND-CPA}\xspace}
\newcommand{\INDCCAone}{\textsf{IND-CCA1}\xspace}
\newcommand{\INDCCA}{\textsf{IND-CCA}\xspace}
\newcommand{\EFCMA}{\textsf{EF-CMA}\xspace}
\newcommand{\LCDH}{\ensuremath{\mathsf{LCDH}}\xspace}
\newcommand{\CDH}{\textsf{CDH}\xspace}
\newcommand{\DDH}{\textsf{DDH}\xspace}
\newcommand{\ElGamal}{\textsf{ElGamal}\xspace}
\newcommand{\HElGamal}{\textsf{HElGamal}\xspace}
\newcommand{\RSA}{\textsf{RSA}\xspace}
\newcommand{\OAEP}{\textsf{OAEP}\xspace}
\newcommand{\FDH}{\textsf{FDH}\xspace}
\newcommand{\HMAC}{\textsf{HMAC}\xspace}
\newcommand{\CS}{\textsf{CS}\xspace}
\newcommand{\Skein}{\textsf{Skein}\xspace}
\newcommand{\TCR}{\textsf{TCR}\xspace}

\newcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\Oracle}{\mathcal{O}}
\newcommand{\KG}{\mathcal{KG}}
\newcommand{\Enc}{\mathcal{E}}
\newcommand{\Dec}{\mathcal{D}}
\newcommand{\Sign}{\mathsf{Sign}}
\newcommand{\Verify}{\mathsf{Verify}}

%% Complexity and termination

\newcommand{\lossless}{\mathsf{lossless}}
\newcommand{\PPT}[1]{\mathsf{PPT}(#1)}
\newcommand{\PPTX}{\mathsf{PPT}}

\newcommand{\bounded}[1]{\mathsf{bounded}(#1)}

%% Sets

\newcommand{\zeroone}{[0,1]}
\newcommand{\bit}{\{0,1\}}
\newcommand{\bitstring}[1]{\ensuremath{\bit^{#1}}}
\newcommand{\zq}{\mathbb{Z}_q}
\newcommand{\bool}{\mathbb{B}}
\newcommand{\nat}{\mathbb{N}}
\newcommand{\real}{\mathbb{R}}
\newcommand{\option}[1]{#1_\bot}

%% Mathematics

\renewcommand{\Pr}[2]{\mathrm{Pr}\left[#1 : #2\right]}
\newcommand{\Prm}[3]{\mathrm{Pr}\left[#1,#3 : #2\right]}
\newcommand{\labs}{\left\lvert}
\newcommand{\rabs}{\right\rvert}
\newcommand{\charfun}{\mathds{1}}
\newcommand{\indicator}[1]{\mathbb{I}_{#1}}
\newcommand{\lub}{\sup}
\newcommand{\negl}{\mathsf{negl}}
\newcommand{\Adv}[2]{\mathbf{Adv}_{\mbox{\scriptsize $#1$}}^{\mbox{\scriptsize $#2$}}}
\newcommand{\Succ}[2]{\mathbf{Succ}_{\mbox{\scriptsize $#1$}}^{\mbox{\scriptsize $#2$}}}
\newcommand{\PER}{\mathsf{PER}}
\newcommand{\sym}{\mathsf{SYM}}

%% Distribution monad

\newcommand{\distr}{\mathcal{D}}
\newcommand{\unit}{\mathsf{unit}}
\newcommand{\bind}{\mathsf{bind}}
\newcommand{\supp}{\mathsf{support}}
\newcommand{\range}[2]{\mathsf{range}~{#1}~{#2}}
\newcommand{\lift}[3]{{#2}\,\mathcal{L}(#1)\,{#3}}

%% Semantics 

\newcommand{\sem}[1]{\llbracket #1 \rrbracket}
\newcommand{\subst}[2]{\left[{}^{#2}/{}_{#1}\right]}
\newcommand{\evalexpr}[1]{\sem{#1}_{\Expr}}
\newcommand{\evaldistr}[1]{\sem{#1}_{\DExpr}}
\newcommand{\eval}[1]{\sem{#1}}
\newcommand{\Proc}{\mathcal{P}}
\newcommand{\Var}{\mathcal{V}}
\newcommand{\Expr}{\mathcal{E}}
\newcommand{\DExpr}{\mathcal{DE}}
\newcommand{\Instr}{\mathcal{I}}
\newcommand{\Cmd}{\mathcal{C}}
\newcommand{\Mem}{\mathcal{M}}
\newcommand{\Decl}{\mathsf{decl}}
\newcommand{\Params}{\mathsf{params}}
\newcommand{\Body}{\mathsf{body}}
\newcommand{\RE}{\mathsf{re}}
\newcommand{\Global}{\mathsf{global}}
\newcommand{\Local}{\mathsf{local}}
\newcommand{\List}[1]{{#1}^*}
\newcommand{\fv}{\mathsf{fv}}
\newcommand{\modifies}{\mathsf{mod}}
\newcommand{\depends}{\mathsf{dep}}
\newcommand{\valid}{\mathsf{valid}}
\newcommand{\glob}{\mathsf{glob}}
\newcommand{\loc}{\mathsf{loc}}
\newcommand{\col}{\textsf{col}}

%% Well-formed adversaries

\newcommand{\Gadv}{\mathcal{RW}}
\newcommand{\Gcomm}{\mathcal{R}}
\newcommand{\Gorcl}{\mathcal{O}}
\newcommand{\GoodWrite}[1]{\mathsf{writable}(#1)}
\newcommand{\GoodRead}[2]{\fv(#2) \subseteq #1}
\newcommand{\GoodAdvc}[3]{#1 \vdash #2\!:\!#3}
\newcommand{\GoodAdv}[2]{#1 \vdash_{\mathrm{wf}} #2}

%% Program equivalence statements 

\newcommand{\Equiv}[4]{\models {#1} \sim {#2} : {#3} \Longrightarrow {#4}}
\newcommand{\AEquiv}[6]{\models {#2} \sim_{#5,#6} {#3} : {#1} \Longrightarrow {#4}}
\newcommand{\JAEquiv}[6]{{#2} \sim_{#5,#6} {#3} : {#1} \Longrightarrow {#4}}
\newcommand{\EquivMem}[2]{\models {#1} \equiv {#2}}
\newcommand{\EqObs}[4]{\models {#1} \simeq^{#3}_{#4} {#2}}
\newcommand{\AEqObs}[5]{\models {#1} \simeq^{#3}_{{#4}} {#2} \preceq {#5}} 
\newcommand{\ACEqObs}[7]
        {\AEqObs{\left[ #1 \right]_{#6}}{\left[ #2 \right]_{#7}}{#3}{#4}{#5}}
\newcommand{\Triple}[3]{\sem{#2} {#3} \preceq {#1}}
\newcommand{\DTriple}[3]{\sem{#2} {#3} \succeq {#1}}
\newcommand{\dequiv}[3]{{#1} \simeq_{#3} {#2}}
\newcommand{\fequiv}[3]{{#1} =_{#3} {#2}}
\newcommand{\Pre}{\Psi}
\newcommand{\Post}{\Phi}
\newcommand{\Inv}{\Phi}
\newcommand{\side}[1]{\langle #1 \rangle}
\newcommand{\sidel}{\side{1}}
\newcommand{\sider}{\side{2}}
\newcommand{\eqobsin}{\mathsf{eqobs\_in}}
\newcommand{\eqobsout}{\mathsf{eqobs\_out}}
\newcommand{\pre}{\Psi}
\newcommand{\post}{\Phi}

%% Variables

\newcommand{\LH}{\gl{L}_H}
\newcommand{\LD}{\gl{L}_\Dec}
\newcommand{\cdef}{\gl{\gamma_\mathsf{def}}}

%% Constants and operators
% TODO: Update!
\newcommand{\true}{\mathsf{true}}
\newcommand{\false}{\mathsf{false}}
\newcommand{\nil}{\mathsf{nil}}
\newcommand{\hd}{\mathsf{hd}}
\newcommand{\tl}{\mathsf{tl}}
\newcommand{\app}{\mathbin{+\mkern-7mu+}}
\newcommand{\concat}{\parallel}
\newcommand{\xor}{\oplus}
\newcommand{\msb}[2]{[#1]^{#2}}
\newcommand{\lsb}[2]{[#1]_{#2}}
\newcommand{\dom}{\mathsf{dom}}
\newcommand{\ran}{\mathsf{ran}}
\newcommand{\fst}{\mathsf{fst}}
\newcommand{\snd}{\mathsf{snd}}
\newcommand{\some}[1]{#1}
\newcommand{\none}{\bot}

%% Language
% TODO: Update!
\newcommand{\Skip}{\mathsf{skip}}
\newcommand{\Seq}[2]{#1;\ #2}
\newcommand{\Ass}[2]{#1 \leftarrow #2}
\newcommand{\Rand}[2]{#1 \stackrel{\raisebox{-.25ex}[.25ex]%
{\tiny $\mathdollar$}}{\raisebox{-.2ex}[.2ex]{$\leftarrow$}} #2}
\newcommand{\Randi}[2]{\Rand{#1}{[0..#2]}}
\newcommand{\Randb}[1]{\Rand{#1}{\bit}}
\newcommand{\Randbs}[2]{\Rand{#1}{\bitstring{#2}}}
\newcommand{\Cond}[3]{\mathsf{if}\ #1\ \mathsf{then}\ #2\ \mathsf{else}\ #3}
\newcommand{\Condt}[2]{\mathsf{if}\ #1\ \mathsf{then}\ #2}
\newcommand{\Else}{\mathsf{else}\ }
\newcommand{\Elsif}{\mathsf{elsif}\ }
\newcommand{\nWhile}[3]{\mathsf{while}_{#1}\ #2\ \mathsf{do}\ #3}
\newcommand{\While}[2]{\mathsf{while}\ #1\ \mathsf{do}\ #2}
\newcommand{\Call}[3]{#1 \leftarrow #2\mathsf{(}#3\mathsf{)}}
\newcommand{\Return}{\mathsf{return}}
\newcommand{\Assert}[1]{\mathsf{assert}~#1}

%% Language definition
\lstnewenvironment{easycrypt}[2][]%
  {\lstset{language=easycrypt,caption=#2,#1}}%
  {}

\newcommand{\rawec}[2][]{\lstinline[language=easycrypt,#1]{#2}}
\newcommand{\ec}[2][]{\lstinline[language=easycrypt,style=easycrypt-pretty,#1]{#2}}

\lstdefinelanguage{easycrypt}{
  style=easycrypt-default,
  procnamekeys={op,pred,fun},
  procnamestyle={\sffamily\itshape},
  morekeywords=[1]{theory,end},
  morekeywords=[2]{type,op,axiom,lemma,module,pred,lambda},
  morekeywords=[3]{var,fun},
  morekeywords=[4]{while,if},
  morekeywords=[5]{bool,int,real,bitstring,array,list,matrix,word},
  morekeywords=[6]{forall,exists},
%  moredirectives={prover,print}, % Incomplete
  morecomment=[n][\itseries]{(*}{*)},
  morecomment=[n][\bfseries]{(**}{*)}
}

\lstdefinestyle{easycrypt-default}{
  columns=fullflexible,
  captionpos=b,
  frame=tb,
  xleftmargin=.1\textwidth,
  xrightmargin=.1\textwidth,
  basicstyle=\small\sffamily,
  identifierstyle={},
  keywordstyle=[1]{\bfseries},
  keywordstyle=[2]{\bfseries},
  keywordstyle=[3]{\bfseries},
  keywordstyle=[4]{\bfseries},
  keywordstyle=[5]{\itshape},
  keywordstyle=[6]{\bfseries}
}

\lstdefinestyle{easycrypt-pretty}{
    basicstyle=\small\sffamily,
    literate={:=}{{$\mathrel{\gets}$}}1
              {<=}{{$\binop{\leq}$}}1
              {>=}{{$\geq$}}1
              {=\$}{{$\stackrel{\$}{\gets}$}}1
              {forall}{{$\forall$}}1
              {exists}{{$\exists$}}1
              {->}{{$\rightarrow\;$}}1
              {=>}{{$\Rightarrow\;$}}1
              {==>}{{$\Rrightarrow\;$}}1
              {\/\\}{{$\wedge$}}1
              {\\\/}{{$\vee$}}1
              {.\[}{{[}}1
              {'a}{{$\alpha\,$}}1
              {'b}{{$\beta\,$}}1
              {'c}{{$\gamma\,$}}1
              {'x}{{$\chi\,$}}1
              {lambda}{{$\lambda\,$}}1
}

%% Typesetting
\newcommand{\titledbox}[4]{{\color{#1}\fbox{\begin{minipage}{#2}{\textbf{#3:} \color{black}#4}\end{minipage}}}}
\newcommand{\warningbox}[1]{\titledbox{red}{.9\textwidth}{Warning}{#1}}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "easycrypt"
%%% End: 
